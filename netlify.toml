[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[dev]
  command = "npm run dev"
  targetPort = 5173
  port = 8888
  framework = "vite"

[functions]
  node_bundler = "esbuild"
  external_node_modules = [
    "stripe",
    "uuid",
    "jsonwebtoken"
  ]

# üîÅ AUTOPILOT CRONS
[functions."expire-features"]
  schedule = "@daily"

[functions."auto-promote-feature"]
  schedule = "@hourly"

[functions."feature-revenue-engine"]
  schedule = "@hourly"

[functions."feature-notification-engine"]
  schedule = "@hourly"

# üåê CORS
[[headers]]
  for = "/.netlify/functions/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Headers = "Content-Type, Authorization"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS"

# üîì ALLOW FUNCTIONS FIRST (CRITICAL)

# ROUTES
[[redirects]]
from = "/dj"
to = "/dj.html"
status = 200

[[redirects]]
from = "/sponsors"
to = "/sponsors.html"
status = 200

[[redirects]]
from = "/news"
to = "/news.html"
status = 200

[[redirects]]
from = "/submit"
to = "/submit.html"
status = 200
