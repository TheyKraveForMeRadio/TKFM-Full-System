<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TKFM Admin Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      background:#000;
      color:#fff;
      font-family: Arial, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      margin:0;
    }
    .box {
      background:#111;
      border:1px solid #222;
      border-radius:14px;
      padding:28px;
      width:100%;
      max-width:360px;
      box-shadow:0 0 30px rgba(255,0,255,.15);
    }
    h1 {
      text-align:center;
      margin-bottom:20px;
    }
    input {
      width:100%;
      padding:12px;
      margin-bottom:12px;
      border-radius:10px;
      border:1px solid #333;
      background:#0b0b0b;
      color:#fff;
      font-size:14px;
    }
    button {
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid #333;
      background:#1b1b1b;
      color:#fff;
      cursor:pointer;
      font-weight:bold;
    }
    button:hover {
      border-color:#555;
    }
    .error {
      margin-top:10px;
      color:#ff7c7c;
      text-align:center;
      font-size:14px;
    }
    .muted {
      text-align:center;
      color:#aaa;
      font-size:12px;
      margin-top:14px;
    }
  </style>
</head>

<body>

<div class="box">
  <h1>üîê TKFM Admin</h1>

  <input id="email" type="email" placeholder="Admin Email" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>

  <div id="error" class="error"></div>

  <div class="muted">
    Authorized staff only
  </div>
</div>

<script>
const API = '/.netlify/functions'
const TOKEN_KEY = 'tkfm_admin_token'

async function login() {
  const email = document.getElementById('email').value.trim()
  const password = document.getElementById('password').value
  const errorBox = document.getElementById('error')

  errorBox.textContent = ''

  if (!email || !password) {
    errorBox.textContent = 'Email and password required'
    return
  }

  try {
    const res = await fetch(`${API}/admin-auth`, {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({ email, password })
    })

    const json = await res.json()

    if (!res.ok || !json.token) {
      errorBox.textContent = json.error || 'Login failed'
      return
    }

    // Save token
    localStorage.setItem(TOKEN_KEY, json.token)

    // Redirect to admin panel
    window.location.href = '/admin/index.html'

  } catch (err) {
    errorBox.textContent = 'Network error'
  }
}

// Auto-redirect if already logged in
if (localStorage.getItem(TOKEN_KEY)) {
  window.location.href = '/admin/index.html'
}
</script>

<script>
async function djLogout() {
  try {
    await fetch('/.netlify/functions/dj-logout', { method: 'POST' })
  } catch {}

  // üî• Actual logout
  localStorage.removeItem('tkfm_dj_token')

  // Redirect to login
  window.location.href = '/dj/login.html'
}
</script>

<button onclick="djLogout()">Logout</button>

</body>
</html>
