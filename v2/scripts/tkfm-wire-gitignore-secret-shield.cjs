#!/usr/bin/env node
/**
 * TKFM: Merge secret-shield .gitignore rules into existing .gitignore (idempotent).
 *
 * Usage:
 *   node scripts/tkfm-wire-gitignore-secret-shield.cjs .
 */
const fs = require('fs');
const path = require('path');

const root = process.argv[2] || '.';
const fp = path.join(root, '.gitignore');

const BLOCK = `# TKFM: Repo Secret Shield + hygiene
.env
.env.*
!.env.example
.tkfm_owner_key
.tKFM_owner_key
*.log
/tmp/*
.tmp/*
.netlify
.DS_Store
Thumbs.db

# Reports generated by scripts
scripts/featured-id-report.txt
scripts/*report*.txt
scripts/*report*.json

# Backup safety (keep local)
backups/*
!backups/.gitignore
`;

let s = '';
if (fs.existsSync(fp)) s = fs.readFileSync(fp, 'utf8');

if (s.includes('# TKFM: Repo Secret Shield + hygiene')) {
  console.log('ALREADY: .gitignore has TKFM secret shield block');
  process.exit(0);
}

if (s && !s.endsWith('\n')) s += '\n';
s += '\n' + BLOCK + '\n';
fs.writeFileSync(fp, s, 'utf8');
console.log('PATCHED: .gitignore');
