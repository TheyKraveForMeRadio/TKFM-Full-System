#!/usr/bin/env bash
set -euo pipefail

# TKFM: if node_modules is accidentally tracked, untrack it (keeps local files).
# Usage: ./scripts/tkfm-untrack-node_modules.sh

if git ls-files --error-unmatch node_modules >/dev/null 2>&1; then
  echo "== node_modules is tracked -> untracking =="
  git rm -r --cached node_modules >/dev/null 2>&1 || git rm -r --cached node_modules
  echo "OK: node_modules removed from git index (still on disk)"
else
  # It might be tracked deeper (node_modules/...)
  if git ls-files | grep -q '^node_modules/'; then
    echo "== node_modules/* is tracked -> untracking =="
    git rm -r --cached node_modules >/dev/null 2>&1 || git rm -r --cached node_modules
    echo "OK: node_modules removed from git index (still on disk)"
  else
    echo "OK: node_modules not tracked"
  fi
fi
