<!doctype html>
<html lang="en">
<head>
  <meta name="tkfm-theme" content="radio" />
  <link rel="stylesheet" href="/css/tkfm-shell.css" />
  <link rel="stylesheet" href="/css/tkfm-radio.css" />
  <script src="/js/tkfm-shell.js" defer></script>

  <meta charset="utf-8" />
  <title>TKFM Radio Hub ‚Äî They Krave For Me Radio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="TKFM Radio Hub ‚Äî live control room for They Krave For Me Radio. See now playing, Autopilot packs, uploads, mixtape projects and fan motion in one place." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/js/logo-check.js" defer></script>
  <style>
    body{
      background:#020617;
      background-image:
        radial-gradient(circle at 0 0,rgba(56,189,248,0.22),transparent 55%),
        radial-gradient(circle at 100% 0,rgba(236,72,153,0.24),transparent 55%),
        radial-gradient(circle at 50% 100%,rgba(168,85,247,0.24),transparent 55%);
    }
    ::-webkit-scrollbar{height:6px;width:6px;}
    ::-webkit-scrollbar-thumb{background:#334155;border-radius:999px;}
    .glass{
      background-color:rgba(15,23,42,0.96);
      backdrop-filter:blur(22px);
    }
  </style>
</head>
<body class="text-slate-50 min-h-screen flex flex-col">

  <!-- NAV -->
  <header class="w-full border-b border-slate-800/80 bg-black/70 backdrop-blur-xl sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      <a href="index.html" class="flex items-center gap-3">
        <img src="/tkfm-radio-logo.png" alt="TKFM Radio" class="h-9 w-auto object-contain" />
        <div class="leading-tight">
          <div class="text-[0.6rem] uppercase tracking-[0.35em] text-slate-400">
            They Krave For Me Radio
          </div>
          <div class="text-sm font-semibold">
            TKFM <span class="text-cyan-300">Radio Hub</span>
          </div>
        </div>
      </a>
      <nav class="ml-auto flex flex-wrap gap-2 text-[0.7rem] uppercase tracking-[0.22em]">
        <a href="creator-pass.html" class="px-3 py-1 rounded-full border border-purple-400/80 bg-purple-400/10 text-purple-200 flex items-center gap-1">
          <span>üé´</span><span>Creator Pass</span>
        </a>
        <a href="fan-pass.html" class="px-3 py-1 rounded-full border border-pink-400/80 bg-pink-400/10 text-pink-200 flex items-center gap-1">
          <span>‚≠ê</span><span>Fan Pass</span>
        </a>
        <a href="djs.html" class="px-3 py-1 rounded-full border border-slate-700/80 bg-slate-950/80 text-slate-100 flex items-center gap-1">
          <span>üéß</span><span>DJs</span>
        </a>
        <a href="news.html" class="px-3 py-1 rounded-full border border-emerald-400/80 bg-emerald-400/10 text-emerald-200 flex items-center gap-1">
          <span>üì∞</span><span>News</span>
        </a>
        <a href="label-home.html" class="px-3 py-1 rounded-full border border-yellow-400/80 bg-yellow-400/10 text-yellow-200 flex items-center gap-1">
          <span>üèõ</span><span>Records</span>
        </a>
        <a href="god-view.html" class="px-3 py-1 rounded-full border border-emerald-300/80 bg-emerald-300/10 text-emerald-200 flex items-center gap-1">
          <span>üëÅ</span><span>GOD VIEW</span>
        </a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1">
    <section class="max-w-6xl mx-auto px-4 pt-8 pb-12 space-y-7">

      <!-- HERO + SNAPSHOT -->
      <div class="flex flex-col lg:flex-row gap-6 items-start">
        <div class="flex-1 space-y-3">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-cyan-400/80 bg-cyan-400/10 text-[0.7rem] uppercase tracking-[0.3em] text-cyan-200">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
            TKFM ‚Ä¢ Radio Control Room
          </div>
          <h1 class="text-3xl md:text-4xl font-extrabold leading-tight">
            Run the <span class="text-pink-400 drop-shadow-[0_0_30px_rgba(236,72,153,0.9)]">Independent Artist Power Station</span> from one screen.
          </h1>
          <p class="text-sm md:text-base text-slate-100/90 max-w-2xl">
            The Radio Hub shows **what‚Äôs spinning**, how the **Autopilot pack** is built and how artists,
            mixtapes and fans are moving through TKFM ‚Äî all powered by your local TKFM v2 brain.
          </p>
          <p class="text-[0.8rem] text-slate-300 max-w-xl">
            Keys read:
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_autopilot_last_pack</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_radio_state</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_radio_now_playing</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_artist_uploads</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">mixtapeOrders</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_fan_profiles</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_radio_likes</span>.
          </p>
        </div>

        <!-- RADIO SNAPSHOT -->
        <aside class="w-full max-w-sm rounded-3xl border border-slate-800 glass relative overflow-hidden">
          <div class="pointer-events-none absolute -inset-20 opacity-40 blur-3xl bg-[conic-gradient(from_120deg,_#22d3ee,_#3b82f6,_#a855f7,_#ec4899,_#22d3ee)]"></div>
          <div class="relative p-4 space-y-3 text-sm">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400 mb-1">
                  Radio Snapshot (This Device)
                </p>
                <p class="text-xs text-slate-100">
                  Everything here is pulled live from this browser‚Äôs localStorage.
                </p>
              </div>
              <button id="hub-refresh" class="px-2.5 py-1 rounded-full border border-cyan-400/80 bg-cyan-400/10 text-[0.65rem] uppercase tracking-[0.22em] text-cyan-200">
                Refresh
              </button>
            </div>

            <div class="grid grid-cols-3 gap-3 text-xs">
              <div>
                <p class="text-slate-300 mb-0.5">Tracks in Pack</p>
                <p id="hub-pack-count" class="text-lg font-bold text-cyan-200">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">Artist Uploads</p>
                <p id="hub-uploads" class="text-lg font-bold text-pink-200">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">Mixtape Orders</p>
                <p id="hub-orders" class="text-lg font-bold text-emerald-200">0</p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-3 text-xs">
              <div>
                <p class="text-slate-300 mb-0.5">Fan Profiles</p>
                <p id="hub-fans" class="text-lg font-bold text-sky-200">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">Likes</p>
                <p id="hub-likes" class="text-lg font-bold text-rose-200">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">History</p>
                <p id="hub-history" class="text-lg font-bold text-amber-200">0</p>
              </div>
            </div>

            <p id="hub-pack-label" class="text-[0.72rem] text-slate-300">
              No pack detected yet. Generate one in Autopilot Engine.
            </p>
          </div>
        </aside>
      </div>

      <!-- TOP GRID: NOW PLAYING + AUTOPILOT + PIPELINE -->
      <section class="grid gap-4 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,0.9fr)]">

        <!-- LEFT: NOW PLAYING TILE -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-5 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                Live Stack
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                What TKFM says is spinning right now.
              </h2>
            </div>
            <a href="now-playing.html" class="text-[0.75rem] px-3 py-1 rounded-full border border-slate-700/80 bg-slate-900/90 text-slate-100 flex items-center gap-1">
              <span>Open full view</span><span>‚Üó</span>
            </a>
          </header>

          <div id="hub-np-empty" class="text-[0.8rem] text-slate-400">
            No Now Playing object yet.  
            Generate a pack in Autopilot and/or visit <span class="text-cyan-300">now-playing.html</span> to seed it.
          </div>

          <div id="hub-np-card" class="hidden relative overflow-hidden rounded-2xl border border-slate-700 bg-slate-950/90">
            <div class="pointer-events-none absolute -inset-24 opacity-35 blur-3xl bg-[conic-gradient(from_200deg,_#22d3ee,_#a855f7,_#ec4899,_#22d3ee)]"></div>
            <div class="relative p-3 flex flex-col gap-2">
              <div class="flex items-start justify-between gap-2">
                <div class="min-w-0">
                  <p id="hub-np-mode" class="text-[0.7rem] text-cyan-300 mb-0.5"></p>
                  <p id="hub-np-title" class="text-sm font-semibold truncate"></p>
                  <p id="hub-np-artist" class="text-[0.8rem] text-slate-200 truncate"></p>
                  <p id="hub-np-meta" class="text-[0.7rem] text-slate-400 truncate"></p>
                </div>
                <span id="hub-np-pos" class="px-2 py-0.5 rounded-full border border-slate-700/80 bg-slate-900/90 text-[0.7rem] text-slate-200">
                  <!-- # / total -->
                </span>
              </div>
              <div class="flex flex-wrap gap-2 mt-1 text-[0.7rem]">
                <span id="hub-np-source" class="px-2 py-0.5 rounded-full border border-slate-700/80 bg-slate-900/90 text-slate-200"></span>
                <span id="hub-np-city" class="hidden px-2 py-0.5 rounded-full border border-slate-700/80 bg-slate-900/90 text-slate-200"></span>
              </div>
              <p id="hub-np-updated" class="text-[0.7rem] text-slate-400 mt-1"></p>
            </div>
          </div>
        </article>

        <!-- RIGHT: AUTOPILOT QUICK VIEW -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-5 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                Autopilot Engine
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                How the current pack was built.
              </h2>
            </div>
            <a href="autopilot-engine.html" class="text-[0.75rem] px-3 py-1 rounded-full border border-cyan-400/80 bg-cyan-400/10 text-cyan-200 flex items-center gap-1">
              <span>Open engine</span><span>‚Üó</span>
            </a>
          </header>

          <div id="hub-ap-empty" class="text-[0.8rem] text-slate-400">
            No Autopilot pack found yet.  
            Use the <span class="text-cyan-300">Autopilot Engine</span> to build a pack from uploads + mixtape projects.
          </div>

          <div id="hub-ap-card" class="hidden space-y-2 text-[0.8rem]">
            <p id="hub-ap-headline" class="text-slate-200"></p>
            <p id="hub-ap-meta" class="text-[0.75rem] text-slate-400"></p>

            <div id="hub-ap-tags" class="flex flex-wrap gap-1 text-[0.7rem] text-slate-300">
              <!-- tags -->
            </div>

            <div id="hub-ap-top" class="space-y-1 mt-2 max-h-40 overflow-y-auto">
              <!-- top tracks list -->
            </div>
          </div>
        </article>
      </section>

      <!-- SECOND ROW: INPUTS + MOTION -->
      <section class="grid gap-4 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)]">

        <!-- INPUT PIPELINE -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-5 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                Input Pipeline
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                Artists, mixtape clients and fans feeding the station.
              </h2>
            </div>
            <span class="text-xl">üéö</span>
          </header>

          <p class="text-[0.8rem] text-slate-300">
            TKFM Radio is only as strong as what flows into it:
            **artist uploads**, **mixtape hosting**, and **fan profiles**.
          </p>

          <div class="grid gap-3 md:grid-cols-3 text-[0.78rem]">
            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Artist Uploads</p>
              <p id="hub-card-uploads" class="text-xl font-bold text-pink-300">0</p>
              <p class="text-[0.75rem] text-slate-300">
                Feed from <span class="font-mono text-cyan-300 text-[0.7rem]">tkfm_artist_uploads</span>.
              </p>
              <a href="artist-upload.html" class="mt-1 inline-flex items-center gap-1 text-[0.75rem] text-pink-300">
                <span>Open upload portal</span><span>‚Üó</span>
              </a>
            </div>

            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Mixtape Hosting</p>
              <p id="hub-card-orders" class="text-xl font-bold text-emerald-300">0</p>
              <p class="text-[0.75rem] text-slate-300">
                From <span class="font-mono text-cyan-300 text-[0.7rem]">mixtapeOrders</span> via mixtape hosting flows.
              </p>
              <a href="dj-mixtape-hosting.html" class="mt-1 inline-flex items-center gap-1 text-[0.75rem] text-emerald-300">
                <span>Host a mixtape</span><span>‚Üó</span>
              </a>
            </div>

            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Fans & Motion</p>
              <p id="hub-card-fans" class="text-xl font-bold text-sky-300">0</p>
              <p class="text-[0.75rem] text-slate-300">
                From <span class="font-mono text-cyan-300 text-[0.7rem]">tkfm_fan_profiles</span> + fan pass interactions.
              </p>
              <a href="fan-pass.html" class="mt-1 inline-flex items-center gap-1 text-[0.75rem] text-sky-300">
                <span>Open Fan Pass</span><span>‚Üó</span>
              </a>
            </div>
          </div>
        </article>

        <!-- MOTION / NEWS TIE-IN -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-5 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                Motion Feed
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                A few recent moves from news + history.
              </h2>
            </div>
            <a href="news.html" class="text-[0.75rem] px-3 py-1 rounded-full border border-emerald-400/80 bg-emerald-400/10 text-emerald-200 flex items-center gap-1">
              <span>Open news</span><span>‚Üó</span>
            </a>
          </header>

          <div id="hub-motion-empty" class="text-[0.8rem] text-slate-400">
            No motion detected yet. Generate a pack, play through a few tracks, or inject manual news to see activity.
          </div>

          <div id="hub-motion-list" class="hidden space-y-2 text-[0.78rem] max-h-52 overflow-y-auto">
            <!-- Filled by JS -->
          </div>
        </article>
      </section>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-slate-800/80 bg-black/70">
    <div class="max-w-6xl mx-auto px-4 py-4 text-[0.7rem] text-slate-400 flex flex-wrap gap-3 items-center">
      <span>¬© 2025 TKFM ‚Äî Radio Hub.</span>
      <span class="opacity-80">
        Central view on the same local brain keys that power Autopilot, Now Playing, DJs, News and TKFM Records.
      </span>
    </div>
  </footer>

  <script>
    // ---------- helpers ----------
    function hubSafeParse(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        const parsed = JSON.parse(raw);
        return parsed ?? fallback;
      } catch (e) {
        console.warn('RadioHub parse fail', key, e);
        return fallback;
      }
    }
    function hubArr(key) {
      const v = hubSafeParse(key, []);
      return Array.isArray(v) ? v : [];
    }
    function hubEscape(str) {
      return String(str || '')
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#039;');
    }
    function hubPrettyDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return '';
      return d.toLocaleString();
    }

    function hubGetPack() {
      const pack = hubSafeParse('tkfm_autopilot_last_pack', null);
      if (!pack || !Array.isArray(pack.tracks)) return { pack: null, tracks: [] };
      return { pack, tracks: pack.tracks };
    }

    function hubRenderSnapshot() {
      const { pack, tracks } = hubGetPack();
      const uploads = hubArr('tkfm_artist_uploads');
      const orders  = hubArr('mixtapeOrders');
      const fans    = hubArr('tkfm_fan_profiles');
      const likes   = hubArr('tkfm_radio_likes');
      const history = hubArr('tkfm_radio_history');

      document.getElementById('hub-pack-count').textContent = tracks.length || 0;
      document.getElementById('hub-uploads').textContent    = uploads.length;
      document.getElementById('hub-orders').textContent     = orders.length;
      document.getElementById('hub-fans').textContent       = fans.length;
      document.getElementById('hub-likes').textContent      = likes.length;
      document.getElementById('hub-history').textContent    = history.length;

      const labelEl = document.getElementById('hub-pack-label');
      if (!pack) {
        labelEl.textContent = 'No pack detected yet. Generate one in Autopilot Engine.';
        return;
      }

      const mode = pack.mode || pack.profile || 'Rotation';
      const profile = pack.profile || '';
      const created = hubPrettyDate(pack.createdAt || pack.timestamp);
      labelEl.textContent =
        'Mode: ' + mode +
        (profile ? ' ‚Ä¢ ' + profile : '') +
        (created ? ' ‚Ä¢ Built ' + created : '');
    }

    function hubRenderNowPlaying() {
      const npObj = hubSafeParse('tkfm_radio_now_playing', null);
      const { pack, tracks } = hubGetPack();

      const empty = document.getElementById('hub-np-empty');
      const card  = document.getElementById('hub-np-card');

      if (!npObj || !tracks.length || !npObj.track) {
        empty.classList.remove('hidden');
        card.classList.add('hidden');
        return;
      }

      empty.classList.add('hidden');
      card.classList.remove('hidden');

      const track = npObj.track;
      const idx   = typeof npObj.index === 'number' ? npObj.index : 0;
      const total = tracks.length;

      const title = track.trackTitle || 'Untitled Record';
      const artist = track.artistName || 'Unknown Artist';
      const city = track.city || '';
      const tag  = track.tag || '';
      const tier = track.tier || '';
      const srcKey  = track.source || track.sourceKey || '';
      const srcType = track.sourceType || '';

      const mode = npObj.mode || pack?.mode || '';
      const profile = npObj.profile || pack?.profile || '';

      document.getElementById('hub-np-title').textContent  = title;
      document.getElementById('hub-np-artist').textContent = artist;

      const metaParts = [];
      if (city) metaParts.push(city);
      if (tag)  metaParts.push(tag);
      document.getElementById('hub-np-meta').textContent = metaParts.join(' ‚Ä¢ ');

      const modeLabel = mode ? mode.toUpperCase() : 'ROTATION';
      document.getElementById('hub-np-mode').textContent =
        modeLabel + (profile ? ' ‚Ä¢ ' + profile : '');

      document.getElementById('hub-np-pos').textContent =
        '#' + (idx + 1) + ' / ' + total;

      const srcLabel =
        srcType === 'mixtape' ? 'Mixtape Project' :
        srcKey === 'tkfm_artist_uploads' ? 'Artist Upload' :
        srcKey === 'mixtapeOrders' ? 'Mixtape Order' :
        'TKFM Rotation';
      document.getElementById('hub-np-source').textContent = srcLabel;

      const cityPill = document.getElementById('hub-np-city');
      if (city) {
        cityPill.textContent = 'üìç ' + city;
        cityPill.classList.remove('hidden');
      } else {
        cityPill.classList.add('hidden');
      }

      const updated = hubPrettyDate(npObj.updatedAt);
      document.getElementById('hub-np-updated').textContent =
        updated ? 'Last updated ' + updated : '';
    }

    function hubRenderAutopilot() {
      const { pack, tracks } = hubGetPack();
      const empty = document.getElementById('hub-ap-empty');
      const card  = document.getElementById('hub-ap-card');

      if (!pack || !tracks.length) {
        empty.classList.remove('hidden');
        card.classList.add('hidden');
        return;
      }

      empty.classList.add('hidden');
      card.classList.remove('hidden');

      const mode = pack.mode || 'Rotation';
      const profile = pack.profile || '';
      const created = hubPrettyDate(pack.createdAt || pack.timestamp);

      const srcSummary = [];
      const uploadsCount = tracks.filter(t => (t.source || t.sourceKey) === 'tkfm_artist_uploads').length;
      const mixCount     = tracks.filter(t => (t.source || t.sourceKey) === 'mixtapeOrders' || t.sourceType === 'mixtape').length;

      if (uploadsCount) srcSummary.push(uploadsCount + ' from uploads');
      if (mixCount)     srcSummary.push(mixCount + ' from mixtapes');
      if (!srcSummary.length) srcSummary.push('Mixed sources');

      document.getElementById('hub-ap-headline').textContent =
        mode.toUpperCase() + (profile ? ' ‚Ä¢ ' + profile : '');
      document.getElementById('hub-ap-meta').textContent =
        tracks.length + ' track' + (tracks.length !== 1 ? 's' : '') +
        ' ‚Ä¢ ' + srcSummary.join(' ‚Ä¢ ') +
        (created ? ' ‚Ä¢ Built ' + created : '');

      const tagEl = document.getElementById('hub-ap-tags');
      const tags = [];
      if (/night/i.test(mode))      tags.push('Night drive');
      if (/club/i.test(mode))       tags.push('Club energy');
      if (/label/i.test(mode))      tags.push('Label focus');
      if (/mixtape/i.test(mode))    tags.push('Mixtape premiere');
      if (!tags.length) tags.push('TKFM Rotation');
      tagEl.innerHTML = tags.map(t =>
        '<span class="px-2 py-0.5 rounded-full border border-slate-700/80 bg-slate-900/90">#' + hubEscape(t) + '</span>'
      ).join('');

      const topEl = document.getElementById('hub-ap-top');
      topEl.innerHTML = tracks.slice(0, 5).map((t, idx) => {
        const city = t.city || '';
        return (
          '<div class="flex items-start gap-2">' +
            '<span class="text-[0.7rem] text-slate-500 mt-[3px]">#' + (idx + 1) + '</span>' +
            '<div class="min-w-0 flex-1">' +
              '<p class="text-[0.8rem] font-semibold truncate">' + hubEscape(t.trackTitle || 'Untitled Record') + '</p>' +
              '<p class="text-[0.75rem] text-slate-300 truncate">' + hubEscape(t.artistName || 'Unknown Artist') +
                (city ? ' ‚Ä¢ ' + hubEscape(city) : '') +
              '</p>' +
            '</div>' +
          '</div>'
        );
      }).join('');
    }

    function hubBuildMotionItems() {
      const news = hubSafeParse('tkfm_news_manual', []);
      const history = hubArr('tkfm_radio_history');

      const items = [];

      if (Array.isArray(news)) {
        news.forEach((n, idx) => {
          items.push({
            type: 'news',
            title: n.title || 'News Item',
            subtitle: n.subtitle || '',
            city: n.city || '',
            actor: n.actor || '',
            createdAt: n.createdAt || n.timestamp || null
          });
        });
      }

      history.forEach((h, idx) => {
        const t = h.track || {};
        items.push({
          type: 'play',
          title: (t.trackTitle || 'Untitled Record'),
          subtitle: (t.artistName || 'Unknown Artist'),
          city: t.city || '',
          actor: '',
          createdAt: h.playedAt || null
        });
      });

      items.sort((a, b) => {
        const da = a.createdAt ? new Date(a.createdAt).getTime() : 0;
        const db = b.createdAt ? new Date(b.createdAt).getTime() : 0;
        return db - da;
      });

      return items;
    }

    function hubRenderMotion() {
      const items = hubBuildMotionItems();
      const empty = document.getElementById('hub-motion-empty');
      const list  = document.getElementById('hub-motion-list');

      if (!items.length) {
        empty.classList.remove('hidden');
        list.classList.add('hidden');
        list.innerHTML = '';
        return;
      }

      empty.classList.add('hidden');
      list.classList.remove('hidden');

      list.innerHTML = items.slice(0, 10).map(item => {
        const dateStr = hubPrettyDate(item.createdAt);
        const isNews = item.type === 'news';

        const badgeClass = isNews
          ? 'border-emerald-400/80 bg-emerald-400/10 text-emerald-100'
          : 'border-slate-700/80 bg-slate-900/90 text-slate-100';

        const badgeLabel = isNews ? 'News' : 'Play';

        return (
          '<article class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-2 flex flex-col gap-1">' +
            '<div class="flex items-start justify-between gap-2">' +
              '<div class="min-w-0">' +
                '<p class="text-[0.8rem] font-semibold truncate">' + hubEscape(item.title) + '</p>' +
                (item.subtitle
                  ? '<p class="text-[0.75rem] text-slate-300 truncate">' + hubEscape(item.subtitle) + '</p>'
                  : ''
                ) +
              '</div>' +
              '<span class="text-[0.65rem] px-2 py-0.5 rounded-full border ' + badgeClass + '">' +
                hubEscape(badgeLabel) +
              '</span>' +
            '</div>' +
            '<div class="flex flex-wrap gap-1 text-[0.7rem] text-slate-300">' +
              (item.city
                ? '<span class="px-2 py-0.5 rounded-full border border-slate-700/80 bg-slate-900/90">üìç ' + hubEscape(item.city) + '</span>'
                : ''
              ) +
              (item.actor
                ? '<span class="px-2 py-0.5 rounded-full border border-slate-700/80 bg-slate-900/90">üé§ ' + hubEscape(item.actor) + '</span>'
                : ''
              ) +
              (dateStr
                ? '<span class="px-2 py-0.5 rounded-full border border-slate-700/80 bg-slate-900/90">' + hubEscape(dateStr) + '</span>'
                : ''
              ) +
            '</div>' +
          '</article>'
        );
      }).join('');
    }

    document.addEventListener('DOMContentLoaded', function () {
      const btnRefresh = document.getElementById('hub-refresh');

      function rerender() {
        hubRenderSnapshot();
        hubRenderNowPlaying();
        hubRenderAutopilot();
        hubRenderMotion();

        // mirror counts into the input cards
        document.getElementById('hub-card-uploads').textContent =
          document.getElementById('hub-uploads').textContent;
        document.getElementById('hub-card-orders').textContent =
          document.getElementById('hub-orders').textContent;
        document.getElementById('hub-card-fans').textContent =
          document.getElementById('hub-fans').textContent;
      }

      btnRefresh?.addEventListener('click', rerender);

      // Initial render
      rerender();
    });
  </script>
</body>
</html>
