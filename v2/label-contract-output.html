<!doctype html>
<html lang="en">
<head>
  <meta name="tkfm-theme" content="label" />
  <link rel="stylesheet" href="/css/tkfm-shell.css" />
  <link rel="stylesheet" href="/css/tkfm-label.css" />
  <script src="/js/tkfm-shell.js" defer></script>

  <meta charset="utf-8">
  <title>TKFM — Label Contract Output</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#05070b;--bg-alt:#060812;--ink:#020617;
      --gold:#facc6b;--amber:#fbbf24;--emerald:#22c55e;
      --text:#f9fafb;--muted:#9ca3af;
      --card:rgba(15,23,42,.97);--border-subtle:rgba(148,163,184,.45);
      --danger:#fb7185;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text",sans-serif;}
    body{
      min-height:100vh;color:var(--text);
      background:
        radial-gradient(circle at 15% -10%,rgba(250,204,21,.16),transparent 60%),
        radial-gradient(circle at 85% 110%,rgba(34,197,94,.16),transparent 60%),
        linear-gradient(to bottom,var(--bg-alt),var(--ink));
      display:flex;flex-direction:column;
    }
    a{text-decoration:none;color:inherit;}

    header{
      position:sticky;top:0;z-index:20;
      padding:.9rem 1.4rem;
      display:flex;align-items:center;justify-content:space-between;gap:.8rem;
      background:rgba(5,7,12,.96);
      border-bottom:1px solid rgba(148,163,184,.5);
      backdrop-filter:blur(16px);
    }
    .brand{display:flex;align-items:center;gap:.6rem;}
    .brand-logo{
      width:32px;height:32px;border-radius:999px;
      border:1px solid var(--gold);
      background:radial-gradient(circle at 25% 0%,#facc6b,#fbbf24 40%,#020617 100%);
      box-shadow:0 0 25px rgba(250,204,21,.7),0 0 28px rgba(34,197,94,.5);
    }
    .brand-title{
      font-size:.78rem;letter-spacing:.18em;text-transform:uppercase;color:var(--muted);
    }
    .brand-subtitle{font-size:1rem;font-weight:650;}

    .header-right{display:flex;flex-wrap:wrap;gap:.5rem;}
    .chip{
      font-size:.72rem;text-transform:uppercase;letter-spacing:.14em;
      padding:.38rem .7rem;border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:radial-gradient(circle at top,rgba(250,204,21,.24),transparent 60%);
      color:var(--muted);
    }

    main{
      flex:1;
      padding:1.3rem;
      display:flex;
      flex-direction:column;
      gap:1rem;
      max-width:960px;
      margin:0 auto;
    }
    @media(max-width:900px){
      header{flex-direction:column;align-items:flex-start;}
      main{padding:1rem;}
    }

    .top-row{
      display:flex;flex-wrap:wrap;gap:.9rem;align-items:flex-start;
    }
    .summary{
      flex:1 1 260px;
      display:flex;flex-wrap:wrap;gap:.7rem;
    }
    .summary-card{
      background:var(--card);border-radius:.9rem;
      padding:.6rem .8rem;
      border:1px solid var(--border-subtle);
      min-width:150px;
    }
    .sum-label{
      font-size:.68rem;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);
      margin-bottom:.15rem;
    }
    .sum-value{font-size:1.1rem;font-weight:650;}
    .sum-sub{font-size:.7rem;color:var(--muted);}

    .actions{
      flex:0 0 auto;
      display:flex;flex-direction:column;gap:.5rem;
      min-width:180px;
    }
    .btn{
      font-size:.75rem;text-transform:uppercase;letter-spacing:.16em;
      padding:.38rem .8rem;border-radius:999px;
      border:1px solid var(--gold);
      background:radial-gradient(circle at top,rgba(250,204,21,.3),transparent 60%);
      color:var(--text);
      cursor:pointer;
      text-align:center;
    }
    .btn.secondary{
      border-color:rgba(148,163,184,.7);
      background:radial-gradient(circle at top,rgba(148,163,184,.22),transparent 60%);
    }

    .info{
      font-size:.72rem;color:var(--muted);margin-top:.15rem;
    }
    .info span.key{color:var(--gold);}
    .info span.bad{color:var(--danger);}

    .contract-shell{
      margin-top:.5rem;
      background:var(--card);
      border-radius:1rem;
      border:1px solid var(--border-subtle);
      padding:1rem;
      box-shadow:0 0 35px rgba(15,23,42,.95);
    }
    .contract-header{
      display:flex;justify-content:space-between;align-items:flex-start;
      gap:.8rem;margin-bottom:.8rem;
    }
    .label-block{
      font-size:.8rem;
    }
    .label-name{
      font-size:1rem;font-weight:650;letter-spacing:.08em;text-transform:uppercase;
    }
    .contract-meta{
      font-size:.74rem;color:var(--muted);text-align:right;
    }
    .contract-meta div strong{color:var(--gold);}

    .contract-title{
      text-align:center;
      font-size:1rem;
      font-weight:650;
      text-transform:uppercase;
      letter-spacing:.15em;
      margin-bottom:.7rem;
    }
    .contract-parties{
      font-size:.8rem;
      margin-bottom:.9rem;
      color:var(--muted);
    }
    .contract-body{
      font-size:.82rem;
      line-height:1.7;
      white-space:pre-wrap;
      border-radius:.7rem;
      border:1px solid rgba(148,163,184,.4);
      padding:.8rem .9rem;
      background:rgba(15,23,42,.96);
    }

    .empty{
      font-size:.8rem;color:var(--muted);padding:.4rem .2rem;
    }

    @media print{
      body{
        background:white;
        color:black;
      }
      header{display:none;}
      main{
        max-width:none;
        margin:0;
        padding:0.6in;
      }
      .summary-card,.actions,.info{
        display:none;
      }
      .contract-shell{
        box-shadow:none;
        border:1px solid #000;
      }
      .contract-body{
        background:white;
        border-color:#000;
      }
    }
  </style>
<script src="/js/tkfm-fx.js"></script>
  <script src="/js/tkfm-quick-checkout.js"></script>
  <script src="/js/tkfm-paid-lane-modal.js" defer></script>
  <script src="/js/tkfm-paid-lane-submit.js" defer></script>
</head>

<body data-tkfm-theme="label">
<script>window.TKFM_FX&&TKFM_FX.mount({ theme: 'label' });</script>
<header>
  <div class="brand">
    <div class="brand-logo"></div>
    <div>
      <div class="brand-title">TKFM LABEL</div>
      <div class="brand-subtitle">Contract Output</div>
    </div>
  </div>
  <div class="header-right">
    <div class="chip">Source: tkfm_contract_latest</div>
    <div class="chip">Print · Save · Sign</div>
  </div>
</header>

<main>
  <section class="top-row">
    <div class="summary">
      <div class="summary-card">
        <div class="sum-label">Artist</div>
        <div id="sumArtist" class="sum-value">—</div>
        <div id="sumProject" class="sum-sub">Project / mixtape</div>
      </div>
      <div class="summary-card">
        <div class="sum-label">Deal Type</div>
        <div id="sumDealType" class="sum-value">—</div>
        <div id="sumTerm" class="sum-sub">Term & territory</div>
      </div>
      <div class="summary-card">
        <div class="sum-label">Financial</div>
        <div id="sumAdvance" class="sum-value">—</div>
        <div id="sumRoyalty" class="sum-sub">Royalty / split</div>
      </div>
      <div class="summary-card">
        <div class="sum-label">Last Generated</div>
        <div id="sumDate" class="sum-value">—</div>
        <div class="sum-sub">Most recent contract in memory.</div>
      </div>
    </div>

    <div class="actions">
      <button id="btnPrint" class="btn">Print / Save PDF</button>
      <button id="btnRefresh" class="btn secondary">Reload from Storage</button>
      <div class="info">
        Reading from <span class="key">localStorage["tkfm_contract_latest"]</span>.
        If this looks empty or old, regenerate in Contract Lab and refresh.
      </div>
    </div>
  </section>

  <section id="contractShell" class="contract-shell">
    <div id="emptyState" class="empty">
      No contract found in <code>tkfm_contract_latest</code>.
      Open the Contract Lab, generate a deal, then come back here to preview & print.
    </div>

    <div id="contractContent" style="display:none;">
      <div class="contract-header">
        <div class="label-block">
          <div class="label-name" id="labelName">They Krave For Me Radio · TKFM Label</div>
          <div id="labelAddress">Label Address / Imprint (configure as needed)</div>
        </div>
        <div class="contract-meta">
          <div><strong>ID:</strong> <span id="metaId">—</span></div>
          <div><strong>Date:</strong> <span id="metaDate">—</span></div>
        </div>
      </div>

      <div id="contractTitle" class="contract-title">Recording / Mixtape Agreement</div>

      <div id="contractParties" class="contract-parties">
        This agreement is made between <strong>TKFM Label</strong> (the "Label") and
        <strong id="partyArtist">[Artist]</strong> (the "Artist") in respect of the project
        <strong id="partyProject">[Project]</strong>.
      </div>

      <div id="contractBody" class="contract-body"></div>
    </div>
  </section>
</main>

<script>
  const KEY = 'tkfm_contract_latest';

  function readLatestContract(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return null;
      const parsed = JSON.parse(raw);
      if(!parsed || typeof parsed!=='object') return null;
      return parsed;
    }catch(e){
      console.error('Error reading tkfm_contract_latest',e);
      return null;
    }
  }

  function fmtDate(val){
    if(!val) return '—';
    try{
      const d = new Date(val);
      if(isNaN(d.getTime())) return String(val);
      return d.toLocaleDateString(undefined, {month:'short',day:'2-digit',year:'numeric'});
    }catch{
      return String(val);
    }
  }

  function fmtMoney(val){
    if(val===null || val===undefined || val==='') return '—';
    const n = Number(val);
    if(isNaN(n)) return String(val);
    return '$'+n.toLocaleString();
  }

  function hydrateSummary(c){
    const artist   = c.artistName || c.artist || '—';
    const project  = c.projectTitle || c.mixtapeTitle || c.releaseTitle || 'No project specified';
    const dealType = c.dealType || c.offerType || 'Label / Mixtape Deal';
    const term     = c.term || c.termLength || c.termText || 'Standard term';
    const territory= c.territory || 'Worldwide';
    const advance  = c.advance || c.advanceAmount;
    const royalty  = c.royalty || c.royaltyRate || c.split || null;

    document.getElementById('sumArtist').textContent  = artist;
    document.getElementById('sumProject').textContent = project;
    document.getElementById('sumDealType').textContent= dealType;
    document.getElementById('sumTerm').textContent    = term+' · '+territory;
    document.getElementById('sumAdvance').textContent = fmtMoney(advance);
    document.getElementById('sumRoyalty').textContent = royalty ? (royalty+'% / split') : 'Configured in body';
    document.getElementById('sumDate').textContent    = fmtDate(c.createdAt || c.generatedAt || c.date);
  }

  function hydrateDocument(c){
    const emptyEl = document.getElementById('emptyState');
    const contentEl = document.getElementById('contractContent');

    if(!c){
      emptyEl.style.display = 'block';
      contentEl.style.display = 'none';
      return;
    }

    emptyEl.style.display = 'none';
    contentEl.style.display = 'block';

    document.getElementById('metaId').textContent =
      c.id || c.contractId || '[auto]';
    document.getElementById('metaDate').textContent =
      fmtDate(c.createdAt || c.generatedAt || c.date);

    const title =
      c.title ||
      c.contractTitle ||
      c.dealType ||
      'Recording / Mixtape Agreement';
    document.getElementById('contractTitle').textContent = title;

    const artist  = c.artistName || c.artist || '[Artist]';
    const project = c.projectTitle || c.mixtapeTitle || c.releaseTitle || '[Project]';

    document.getElementById('partyArtist').textContent = artist;
    document.getElementById('partyProject').textContent = project;

    let body =
      c.body ||
      c.contractBody ||
      c.fullText ||
      'No contract body text found. Please regenerate in Contract Lab.';

    // If body looks too raw, we still just show it. You can refine upstream in Contract Lab.
    document.getElementById('contractBody').textContent = body;
  }

  function refresh(){
    const latest = readLatestContract();
    hydrateSummary(latest || {});
    hydrateDocument(latest);
  }

  document.getElementById('btnPrint').addEventListener('click',()=>window.print());
  document.getElementById('btnRefresh').addEventListener('click',refresh);

  refresh();
</script>
  <script type="module" src="/js/tkfm-logo-resolver.js"></script>
<script src="/js/tkfm-checkout.js"></script>
<script src="/js/tkfm-paid-lane-modal.js"></script>
</body>
</html>
