<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>TKFM Records ‚Äî Contract Lab</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    :root {
      --bg-deep: #020617;
      --bg-card: rgba(6,8,20,0.98);
      --bg-soft: rgba(15,23,42,0.96);
      --gold: #facc15;
      --gold-deep: #eab308;
      --amber: #f97316;
      --accent-purple: #a855f7;
      --accent-pink: #ec4899;
      --accent-cyan: #22d3ee;
      --text-main: #f9fafb;
      --text-muted: #94a3b8;
      --text-soft: #64748b;
      --border-subtle: rgba(148,163,184,0.35);
    }

    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      min-height:100vh;
      background:
        radial-gradient(circle at top,#111827 0,transparent 52%),
        radial-gradient(circle at top right,rgba(234,179,8,0.55) 0,transparent 60%),
        radial-gradient(circle at top left,rgba(248,113,113,0.45) 0,transparent 60%),
        linear-gradient(to bottom,#020617,#020617 55%,#000 100%);
      color:var(--text-main);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif;
      -webkit-font-smoothing:antialiased;
      padding:1.6rem .9rem 2.3rem;
      overflow-x:hidden;
    }
    a { color:inherit; text-decoration:none; }

    .shell { max-width:1120px; margin:0 auto; }

    /* NAV */
    .nav {
      margin:-1.6rem -.9rem 1.1rem;
      padding:.75rem .9rem;
      background:linear-gradient(to right,rgba(6,8,20,0.98),rgba(15,23,42,0.98));
      border-bottom:1px solid var(--border-subtle);
      backdrop-filter:blur(18px);
      display:flex; align-items:center; gap:.8rem;
    }
    .nav-left { display:flex; align-items:center; gap:.7rem; }
    .logo-orb {
      width:2.4rem; height:2.4rem; border-radius:999px;
      background:radial-gradient(circle at 10% 0,var(--gold),var(--amber) 40%,var(--accent-purple) 80%);
      box-shadow:0 0 22px rgba(250,204,21,.9),0 0 24px rgba(248,113,113,.9);
      border:1px solid rgba(250,204,21,.9);
      display:flex; align-items:center; justify-content:center;
      font-size:.8rem; font-weight:800; letter-spacing:.12em; text-transform:uppercase;
      color:#020617;
    }
    .brand-text { display:flex; flex-direction:column; line-height:1.05; }
    .brand-kicker {
      font-size:.62rem; letter-spacing:.2em; text-transform:uppercase; color:var(--text-soft);
    }
    .brand-main { font-size:.95rem; font-weight:700; }

    .nav-right {
      margin-left:auto;
      display:flex; flex-wrap:wrap; gap:.4rem;
    }
    .nav-pill {
      font-size:.64rem; text-transform:uppercase; letter-spacing:.18em;
      padding:.34rem .72rem; border-radius:999px;
      border:1px solid var(--border-subtle);
      background:var(--bg-soft); color:var(--text-soft); white-space:nowrap;
    }
    .nav-pill.primary {
      border-color:var(--gold);
      color:#020617;
      background:linear-gradient(135deg,var(--gold),var(--amber));
      box-shadow:0 0 18px rgba(250,204,21,.9);
      font-weight:650;
    }
    @media(max-width:960px){ .nav-right{display:none;} }

    /* LAYOUT */
    .hero { margin-bottom:1.2rem; }
    .hero-kicker {
      font-size:.7rem; text-transform:uppercase; letter-spacing:.26em;
      color:var(--text-soft); margin-bottom:.4rem;
    }
    .hero-title {
      font-size:clamp(2.1rem,3.5vw,2.6rem);
      font-weight:800; line-height:1.04; margin-bottom:.4rem;
    }
    .hero-title span {
      background:linear-gradient(135deg,var(--gold),var(--amber),var(--accent-pink));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .hero-sub {
      font-size:.86rem; color:var(--text-muted);
      max-width:40rem; margin-bottom:.6rem;
    }

    .grid {
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,1.1fr);
      gap:.9rem;
      align-items:flex-start;
    }
    @media(max-width:960px){ .grid{grid-template-columns:1fr;} }

    .card {
      border-radius:.95rem;
      border:1px solid var(--border-subtle);
      background:var(--bg-card);
      padding:.8rem .85rem .95rem;
      font-size:.8rem;
      box-shadow:0 0 22px rgba(0,0,0,0.95);
    }
    .card-title { font-size:.92rem; font-weight:650; margin-bottom:.25rem; }
    .card-sub { font-size:.78rem; color:var(--text-muted); margin-bottom:.5rem; }

    .form-row {
      display:flex; flex-wrap:wrap; gap:.6rem; margin-bottom:.6rem;
    }
    .field { flex:1; min-width:180px; }
    .label {
      font-size:.7rem; text-transform:uppercase; letter-spacing:.18em;
      color:var(--text-soft); margin-bottom:.22rem;
    }
    .input, .select, .textarea {
      width:100%;
      border-radius:.65rem;
      border:1px solid var(--border-subtle);
      background:var(--bg-soft);
      padding:.44rem .6rem;
      font-size:.8rem;
      color:var(--text-main);
    }
    .textarea { min-height:120px; resize:vertical; }

    .btn-main {
      font-size:.74rem; text-transform:uppercase; letter-spacing:.18em;
      padding:.48rem 1.1rem; border-radius:999px;
      border:1px solid var(--gold);
      background:linear-gradient(135deg,var(--gold),var(--amber));
      color:#020617; cursor:pointer; font-weight:650;
      box-shadow:0 0 18px rgba(250,204,21,.9); white-space:nowrap;
    }
    .btn-ghost {
      font-size:.72rem; text-transform:uppercase; letter-spacing:.18em;
      padding:.44rem .98rem; border-radius:999px;
      border:1px solid var(--border-subtle);
      background:var(--bg-soft);
      color:var(--text-soft); cursor:pointer; white-space:nowrap;
    }

    .mono {
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .note { font-size:.7rem; color:var(--text-soft); margin-top:.4rem; }

    .preview {
      border-radius:.8rem;
      border:1px solid var(--border-subtle);
      background:#020617;
      padding:.6rem .7rem;
      font-size:.78rem;
      max-height:260px;
      overflow:auto;
      white-space:pre-wrap;
    }

    .list {
      border-radius:.75rem;
      border:1px solid var(--border-subtle);
      background:#020617;
      max-height:200px;
      overflow:auto;
      font-size:.74rem;
      margin-top:.5rem;
    }
    .row {
      padding:.4rem .55rem;
      border-bottom:1px solid rgba(15,23,42,0.95);
      display:flex; justify-content:space-between; gap:.4rem;
    }
    .row:nth-child(odd){ background:rgba(15,23,42,0.96); }
    .row-main { flex:1; }
    .row-title { font-weight:600; margin-bottom:.02rem; }
    .row-sub { font-size:.7rem; color:var(--text-soft); }
    .row-right { font-size:.7rem; color:var(--text-soft); text-align:right; min-width:3.6rem; }
  </style>
</head>
<body>
  <div class="shell">
    <header class="nav">
      <div class="nav-left">
        <div class="logo-orb">CL</div>
        <div class="brand-text">
          <div class="brand-kicker">TKFM Records</div>
          <div class="brand-main">Label Contract Lab</div>
        </div>
      </div>
      <nav class="nav-right">
        <a href="label-home.html" class="nav-pill">üèõ Label Home</a>
        <a href="label-hub.html" class="nav-pill">üìÇ Label Hub</a>
        <a href="label-contract-output.html" class="nav-pill primary">üñ® Contract Output</a>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-kicker">Deal drafting</div>
      <h1 class="hero-title">
        Turn artist data into <span>deal-ready contracts</span>.
      </h1>
      <p class="hero-sub">
        This lab helps you draft simple deal language for TKFM Records. Output is stored in
        <span class="mono">tkfm_contract_latest</span> for printing through the Contract Output page.
      </p>
    </section>

    <section class="grid">
      <!-- FORM -->
      <article class="card">
        <div class="card-title">Contract Inputs</div>
        <div class="card-sub">
          Start with the basics. You can refine or re-draft inside
          <span class="mono">label-contract-output.html</span> when you‚Äôre ready to print.
        </div>

        <div class="form-row">
          <div class="field">
            <div class="label">Artist / Entity Name</div>
            <input id="contractArtist" class="input" placeholder="Artist legal or stage name">
          </div>
          <div class="field">
            <div class="label">Deal Type</div>
            <select id="contractType" class="select">
              <option value="">Select</option>
              <option value="single">Single Deal</option>
              <option value="mixtape">Mixtape / Project</option>
              <option value="ep">EP / Short Project</option>
              <option value="album">Album / Long Project</option>
              <option value="jointventure">Joint Venture / Partnership</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <div class="label">Term Length</div>
            <input id="contractTerm" class="input" placeholder="Example: 1 year initial term + options">
          </div>
          <div class="field">
            <div class="label">Territory</div>
            <input id="contractTerritory" class="input" placeholder="Example: Worldwide">
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <div class="label">Advance (if any)</div>
            <input id="contractAdvance" class="input" placeholder="Example: $5,000 recoupable">
          </div>
          <div class="field">
            <div class="label">Royalty Split</div>
            <input id="contractSplit" class="input" placeholder="Example: 50/50 net, or 70/30, etc.">
          </div>
        </div>

        <div class="form-row">
          <div class="field" style="flex:1 0 100%;">
            <div class="label">Special Notes / Responsibilities</div>
            <textarea id="contractNotes" class="textarea" placeholder="Marketing obligations, content expectations, show support, etc."></textarea>
          </div>
        </div>

        <div class="form-row">
          <button type="button" class="btn-main" id="btnGenerate">Generate Contract Draft</button>
          <button type="button" class="btn-ghost" id="btnClear">Clear Latest Draft</button>
        </div>

        <div class="note">
          Generated text is stored as the latest entry in <span class="mono">tkfm_contract_latest</span>.
          You can have the output page show the most recent or last few items depending on how you wire it.
        </div>
      </article>

      <!-- PREVIEW + HISTORY -->
      <article class="card">
        <div class="card-title">Draft Preview</div>
        <div class="card-sub">
          This is what will be passed to <span class="mono">label-contract-output.html</span> for printing or
          PDF export once you wire that side.
        </div>
        <div id="draftPreview" class="preview">
          No contract draft yet. Fill in the form on the left and generate to see a draft here.
        </div>

        <div class="card-sub" style="margin-top:.7rem;">Recent Drafts (this device)</div>
        <div id="draftList" class="list">
          <!-- JS rows -->
        </div>
      </article>
    </section>
  </div>

  <script>
    (function(){
      const KEY_CONTRACT = 'tkfm_contract_latest';

      function safeParse() {
        try {
          const raw = localStorage.getItem(KEY_CONTRACT);
          if (!raw) return [];
          const v = JSON.parse(raw);
          if (Array.isArray(v)) return v;
          if (v) return [v];
          return [];
        } catch (e) {
          console.warn('contract parse error', e);
          return [];
        }
      }

      function saveContracts(list) {
        localStorage.setItem(KEY_CONTRACT, JSON.stringify(list));
      }

      function buildDraftText(payload) {
        const {
          artist, type, term, territory,
          advance, split, notes, createdAt
        } = payload;

        const dateStr = new Date(createdAt || Date.now()).toLocaleDateString();

        return [
          'TKFM RECORDS ‚Äî DEAL MEMO / CONTRACT DRAFT',
          '',
          'Date: ' + dateStr,
          '',
          'Artist / Entity: ' + (artist || '____________________'),
          'Deal Type: ' + (type || '____________________'),
          '',
          '1. Term',
          '   The initial term of this agreement is: ' + (term || 'to be defined by parties.') ,
          '',
          '2. Territory',
          '   Territory covered under this agreement: ' + (territory || 'World, unless otherwise agreed in final paperwork.') ,
          '',
          '3. Advance & Recoupment',
          '   Label advance (if any): ' + (advance || 'None specified; subject to final negotiation.'),
          '   Any advance is typically recoupable from artist share of revenue as detailed in final contract.',
          '',
          '4. Royalty / Revenue Split',
          '   Proposed split: ' + (split || 'To be determined between TKFM Records and artist.'),
          '',
          '5. Label & Artist Responsibilities',
          '   Summary notes: ' + (notes || 'To be written and agreed in final long-form contract.'),
          '',
          '6. Misc',
          '   This draft is for discussion purposes only and does not constitute a fully executed agreement.',
          '',
          'Signed: _______________________        TKFM Records',
          'Artist / Representative'
        ].join('\n');
      }

      function renderPreview(latest, all) {
        const box = document.getElementById('draftPreview');
        if (!box) return;

        if (!latest) {
          box.textContent = 'No contract draft yet. Fill in the form on the left and generate to see a draft here.';
        } else {
          box.textContent = latest.text;
        }

        const listBox = document.getElementById('draftList');
        if (!listBox) return;
        listBox.innerHTML = '';

        if (!all || !all.length) {
          const row = document.createElement('div');
          row.className = 'row';
          row.textContent = 'No saved drafts on this device yet.';
          listBox.appendChild(row);
          return;
        }

        all.slice().reverse().slice(0,5).forEach(item => {
          const row = document.createElement('div');
          row.className = 'row';

          const main = document.createElement('div');
          main.className = 'row-main';

          const title = document.createElement('div');
          title.className = 'row-title';
          title.textContent = (item.artist || 'Artist') + ' ‚Äî ' + (item.type || 'Deal');

          const sub = document.createElement('div');
          sub.className = 'row-sub';
          const d = new Date(item.createdAt || Date.now());
          sub.textContent = d.toLocaleString();

          main.appendChild(title);
          main.appendChild(sub);

          const right = document.createElement('div');
          right.className = 'row-right';
          right.textContent = 'DRAFT';

          row.appendChild(main);
          row.appendChild(right);
          listBox.appendChild(row);
        });
      }

      function generateDraft() {
        const artist = document.getElementById('contractArtist').value.trim();
        const type = document.getElementById('contractType').value || '';
        const term = document.getElementById('contractTerm').value.trim();
        const territory = document.getElementById('contractTerritory').value.trim();
        const advance = document.getElementById('contractAdvance').value.trim();
        const split = document.getElementById('contractSplit').value.trim();
        const notes = document.getElementById('contractNotes').value.trim();

        if (!artist || !type) {
          alert('Please fill in at least Artist / Entity Name and Deal Type.');
          return;
        }

        const createdAt = Date.now();
        const text = buildDraftText({ artist, type, term, territory, advance, split, notes, createdAt });

        const contracts = safeParse();
        contracts.push({
          artist, type, term, territory, advance, split, notes,
          text, createdAt
        });
        saveContracts(contracts);

        renderPreview(contracts[contracts.length - 1], contracts);
        alert('Contract draft saved to tkfm_contract_latest for this device.');
      }

      function clearDrafts() {
        if (!confirm('Clear all contract drafts on this device?')) return;
        localStorage.removeItem(KEY_CONTRACT);
        renderPreview(null, []);
      }

      function init() {
        const btnGen = document.getElementById('btnGenerate');
        const btnClear = document.getElementById('btnClear');

        if (btnGen) btnGen.addEventListener('click', generateDraft);
        if (btnClear) btnClear.addEventListener('click', clearDrafts);

        const contracts = safeParse();
        const latest = contracts.length ? contracts[contracts.length - 1] : null;
        renderPreview(latest, contracts);
      }

      window.addEventListener('DOMContentLoaded', init);
    })();
  </script>
  <script src="/js/owner-lock.js" data-owner-page="owner"></script>
</body>
</html>
