<!doctype html>
<html lang="en">
<head>
  <meta name="tkfm-theme" content="radio" />
  <link rel="stylesheet" href="/css/tkfm-shell.css" />
  <link rel="stylesheet" href="/css/tkfm-radio.css" />
  <script src="/js/tkfm-shell.js" defer></script>

  <meta charset="utf-8" />
  <title>TKFM Momentum Engine ‚Äî They Krave For Me Radio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="TKFM Momentum Engine ‚Äî performance dashboard for They Krave For Me Radio & TKFM Records powered by TKFM v2 local brain keys." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/js/logo-check.js" defer></script>
  <style>
    body{
      background:#020617;
      background-image:
        radial-gradient(circle at 0 0,rgba(56,189,248,0.22),transparent 55%),
        radial-gradient(circle at 100% 0,rgba(236,72,153,0.24),transparent 55%),
        radial-gradient(circle at 50% 100%,rgba(236,72,153,0.22),transparent 55%);
    }
    ::-webkit-scrollbar{height:6px;width:6px;}
    ::-webkit-scrollbar-thumb{background:#334155;border-radius:999px;}
    .glass{
      background-color:rgba(15,23,42,0.96);
      backdrop-filter:blur(22px);
    }
  </style>
<script src="/js/tkfm-fx.js"></script>
</head>
<body class="text-slate-50 min-h-screen flex flex-col" data-tkfm-theme="radio">
<script>window.TKFM_FX&&TKFM_FX.mount({ theme: 'radio' });</script>

  <!-- NAV -->
  <header class="w-full border-b border-slate-800/80 bg-black/70 backdrop-blur-xl sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      <a href="index.html" class="flex items-center gap-3">
        <img src="/tkfm-radio-logo.png" alt="TKFM Radio" class="h-9 w-auto object-contain" />
        <div class="leading-tight">
          <div class="text-[0.6rem] uppercase tracking-[0.35em] text-slate-400">
            They Krave For Me Radio
          </div>
          <div class="text-sm font-semibold">
            TKFM <span class="text-cyan-300">Momentum Engine</span>
          </div>
        </div>
      </a>
      <nav class="ml-auto flex flex-wrap gap-2 text-[0.7rem] uppercase tracking-[0.22em]">
        <a href="radio-hub.html" class="px-3 py-1 rounded-full border border-slate-700/80 bg-slate-950/80 text-slate-100 flex items-center gap-1">
          <span>üìª</span><span>Radio Hub</span>
        </a>
        <a href="autopilot-engine.html" class="px-3 py-1 rounded-full border border-cyan-400/80 bg-cyan-400/10 text-cyan-200 flex items-center gap-1">
          <span>‚öô</span><span>Autopilot</span>
        </a>
        <a href="feature-revenue.html" class="px-3 py-1 rounded-full border border-emerald-400/80 bg-emerald-400/10 text-emerald-200 flex items-center gap-1">
          <span>üí∞</span><span>Revenue Engine</span>
        </a>
        <a href="label-home.html" class="px-3 py-1 rounded-full border border-yellow-400/80 bg-yellow-400/10 text-yellow-200 flex items-center gap-1">
          <span>üèõ</span><span>TKFM Records</span>
        </a>
        <a href="god-view.html" class="px-3 py-1 rounded-full border border-emerald-300/80 bg-emerald-300/10 text-emerald-200 flex items-center gap-1">
          <span>üëÅ</span><span>GOD VIEW</span>
        </a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1">
    <section class="max-w-6xl mx-auto px-4 pt-8 pb-12 space-y-7">

      <!-- HERO + SNAPSHOT -->
      <div class="flex flex-col lg:flex-row gap-6 items-start">
        <div class="flex-1 space-y-3">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-cyan-400/80 bg-cyan-400/10 text-[0.7rem] uppercase tracking-[0.3em] text-cyan-200">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
            TKFM ‚Ä¢ Momentum Engine
          </div>
          <h1 class="text-3xl md:text-4xl font-extrabold leading-tight">
            Watch how the <span class="text-pink-400 drop-shadow-[0_0_30px_rgba(236,72,153,0.9)]">Independent Artist Power Station</span> is moving.
          </h1>
          <p class="text-sm md:text-base text-slate-100/90 max-w-2xl">
            This is your **performance dashboard**: uploads, mixtape projects, fans, likes and spins ‚Äî
            all pulled from the same TKFM v2 brain the rest of your pages use.
          </p>
          <p class="text-[0.78rem] text-slate-300 max-w-xl">
            Keys read:
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_artist_uploads</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">mixtapeOrders</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_fan_profiles</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_radio_likes</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">tkfm_radio_history</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">sponsors</span>,
            <span class="font-mono text-cyan-300 text-[0.75rem]">stats</span>.
          </p>
        </div>

        <!-- SNAPSHOT -->
        <aside class="w-full max-w-sm rounded-3xl border border-slate-800 glass relative overflow-hidden">
          <div class="pointer-events-none absolute -inset-20 opacity-40 blur-3xl bg-[conic-gradient(from_120deg,_#22d3ee,_#3b82f6,_#a855f7,_#ec4899,_#22d3ee)]"></div>
          <div class="relative p-4 space-y-3 text-sm">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400 mb-1">
                  Momentum Snapshot (This Device)
                </p>
                <p class="text-xs text-slate-100">
                  Dev-mode only: reads from localStorage to give you a sense of motion.
                </p>
              </div>
              <button id="mm-refresh" class="px-2.5 py-1 rounded-full border border-cyan-400/80 bg-cyan-400/10 text-[0.65rem] uppercase tracking-[0.22em] text-cyan-200">
                Refresh
              </button>
            </div>

            <div class="grid grid-cols-3 gap-3 text-xs">
              <div>
                <p class="text-slate-300 mb-0.5">Artist Uploads</p>
                <p id="mm-uploads" class="text-lg font-bold text-pink-300">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">Mixtape Orders</p>
                <p id="mm-orders" class="text-lg font-bold text-emerald-300">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">Fan Profiles</p>
                <p id="mm-fans" class="text-lg font-bold text-sky-300">0</p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-3 text-xs">
              <div>
                <p class="text-slate-300 mb-0.5">Likes</p>
                <p id="mm-likes" class="text-lg font-bold text-rose-300">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">Spins Logged</p>
                <p id="mm-plays" class="text-lg font-bold text-amber-300">0</p>
              </div>
              <div>
                <p class="text-slate-300 mb-0.5">Sponsors</p>
                <p id="mm-sponsors" class="text-lg font-bold text-emerald-200">0</p>
              </div>
            </div>

            <p id="mm-score-label" class="text-[0.72rem] text-slate-300">
              Momentum score: 0 (dev-mode estimate based on local counts).
            </p>
          </div>
        </aside>
      </div>

      <!-- ROW 2: POWER METER + INPUTS -->
      <section class="grid gap-4 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)]">

        <!-- POWER METER -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-6 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                Power Meter (Dev Estimate)
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                Quick feel for platform momentum from orders & fans.
              </h2>
            </div>
            <span class="text-xl">‚ö°</span>
          </header>

          <p class="text-[0.8rem] text-slate-300">
            In dev mode we fake a ‚Äúpower score‚Äù by multiplying:
            <span class="font-semibold">Starter / Pro / Elite mixtape orders</span> with rough multipliers,
            then add contribution from **fans** and **sponsors**.
            In production these would be real revenue metrics.
          </p>

          <div class="grid gap-3 md:grid-cols-4 text-[0.78rem] mt-2">
            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Starter</p>
              <p id="mm-tier-starter" class="text-xl font-bold text-slate-100">0</p>
              <p class="text-[0.75rem] text-slate-300">Orders at Starter tier.</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Pro</p>
              <p id="mm-tier-pro" class="text-xl font-bold text-emerald-300">0</p>
              <p class="text-[0.75rem] text-slate-300">Orders at Pro tier.</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Elite</p>
              <p id="mm-tier-elite" class="text-xl font-bold text-pink-300">0</p>
              <p class="text-[0.75rem] text-slate-300">Orders at Elite tier.</p>
            </div>
            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Power Score</p>
              <p id="mm-power" class="text-xl font-bold text-cyan-300">0</p>
              <p class="text-[0.75rem] text-slate-300">Dev-only ‚Äúheat‚Äù index.</p>
            </div>
          </div>

          <p id="mm-stats-note" class="text-[0.75rem] text-slate-400 mt-2">
            If you use a <span class="font-mono text-cyan-300 text-[0.75rem]">stats</span> object (ex: eliteSold), we‚Äôll surface it below.
          </p>
          <div id="mm-stats-extra" class="text-[0.75rem] text-slate-300 mt-1"></div>
        </article>

        <!-- INPUT MIX SUMMARY -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-6 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                Input Mix
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                Where TKFM motion is really coming from.
              </h2>
            </div>
            <span class="text-xl">üéõ</span>
          </header>

          <div class="grid gap-3 text-[0.78rem]">
            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Artists</p>
              <p id="mm-input-artists" class="text-lg font-semibold text-slate-100">0</p>
              <p class="text-[0.75rem] text-slate-300">
                Unique artist names found in <span class="font-mono text-cyan-300 text-[0.72rem]">tkfm_artist_uploads</span>.
              </p>
              <a href="artist-submissions-console.html" class="mt-1 inline-flex items-center gap-1 text-[0.75rem] text-pink-300">
                <span>View submission console</span><span>‚Üó</span>
              </a>
            </div>

            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Mixtape Clients</p>
              <p id="mm-input-clients" class="text-lg font-semibold text-emerald-300">0</p>
              <p class="text-[0.75rem] text-slate-300">
                Unique clients from <span class="font-mono text-cyan-300 text-[0.72rem]">mixtapeOrders</span>.
              </p>
              <a href="dj-mixtape-orders.html" class="mt-1 inline-flex items-center gap-1 text-[0.75rem] text-emerald-300">
                <span>View orders console</span><span>‚Üó</span>
              </a>
            </div>

            <div class="rounded-2xl border border-slate-800 bg-slate-950/90 px-3 py-3 flex flex-col gap-1">
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400">Active Fans</p>
              <p id="mm-input-active-fans" class="text-lg font-semibold text-sky-300">0</p>
              <p class="text-[0.75rem] text-slate-300">
                Count of fan profiles with any saved interaction fields (likes, points, etc).
              </p>
              <a href="fan-pass.html" class="mt-1 inline-flex items-center gap-1 text-[0.75rem] text-sky-300">
                <span>Open Fan Pass</span><span>‚Üó</span>
              </a>
            </div>
          </div>
        </article>
      </section>

      <!-- ROW 3: FEEDS -->
      <section class="grid gap-4 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)]">

        <!-- LATEST UPLOADS + MIXTAPE ORDERS -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-6 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                Latest Inputs
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                Fresh uploads + mixtape projects entering the TKFM universe.
              </h2>
            </div>
            <span class="text-xl">üé∂</span>
          </header>

          <div class="grid gap-4 md:grid-cols-2 text-[0.78rem]">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400 mb-1">
                Recent Artist Uploads
              </p>
              <div id="mm-uploads-empty" class="text-[0.78rem] text-slate-400">
                No uploads found yet. Use the upload portal or Dev Console demo loader.
              </div>
              <div id="mm-uploads-list" class="hidden space-y-1.5 max-h-44 overflow-y-auto">
                <!-- filled by JS -->
              </div>
            </div>

            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400 mb-1">
                Recent Mixtape Orders
              </p>
              <div id="mm-orders-empty" class="text-[0.78rem] text-slate-400">
                No mixtape orders found yet. Use the mixtape hosting flows to add some.
              </div>
              <div id="mm-orders-list" class="hidden space-y-1.5 max-h-44 overflow-y-auto">
                <!-- filled by JS -->
              </div>
            </div>
          </div>
        </article>

        <!-- RECENT SPINS / LIKES -->
        <article class="rounded-3xl border border-slate-800 glass p-4 md:p-6 text-sm space-y-3">
          <header class="flex items-center justify-between gap-2">
            <div>
              <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-400">
                On-Air Motion
              </p>
              <h2 class="text-sm font-semibold text-slate-50">
                Recent spins & likes from this device.
              </h2>
            </div>
            <a href="now-playing.html" class="text-[0.75rem] px-3 py-1 rounded-full border border-slate-700/80 bg-slate-900/90 text-slate-100 flex items-center gap-1">
              <span>View Now Playing</span><span>‚Üó</span>
            </a>
          </header>

          <div>
            <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400 mb-1">
              Recent Spins
            </p>
            <div id="mm-plays-empty" class="text-[0.78rem] text-slate-400">
              No radio history logged yet. Use Now Playing controls on this device to start a log.
            </div>
            <div id="mm-plays-list" class="hidden space-y-1.5 max-h-32 overflow-y-auto">
              <!-- plays -->
            </div>
          </div>

          <div>
            <p class="text-[0.7rem] uppercase tracking-[0.22em] text-slate-400 mb-1 mt-3">
              Most Recent Likes
            </p>
            <div id="mm-likes-empty" class="text-[0.78rem] text-slate-400">
              No likes recorded yet. Hit ‚ô• on Now Playing to seed this list.
            </div>
            <div id="mm-likes-list" class="hidden space-y-1.5 max-h-32 overflow-y-auto">
              <!-- likes -->
            </div>
          </div>
        </article>
      </section>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-slate-800/80 bg-black/70">
    <div class="max-w-6xl mx-auto px-4 py-4 text-[0.7rem] text-slate-400 flex flex-wrap gap-3 items-center">
      <span>¬© 2025 TKFM ‚Äî Momentum Engine.</span>
      <span class="opacity-80">
        Dev-mode dashboard built on TKFM v2 local keys. In production, mirror this to a shared DB + analytics.
      </span>
    </div>
  </footer>

  <script>
    // ---------- helpers ----------
    function mmSafeParse(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        const parsed = JSON.parse(raw);
        return parsed ?? fallback;
      } catch (e) {
        console.warn('Momentum parse fail', key, e);
        return fallback;
      }
    }
    function mmArr(key) {
      const v = mmSafeParse(key, []);
      return Array.isArray(v) ? v : [];
    }
    function mmEscape(str) {
      return String(str || '')
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#039;');
    }
    function mmPrettyDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return '';
      return d.toLocaleString();
    }

    function computePower(mixtapeOrders, fans, sponsors) {
      const tiers = { starter: 0, pro: 0, elite: 0 };
      mixtapeOrders.forEach(o => {
        const t = (o.tier || '').toLowerCase();
        if (t.includes('elite')) tiers.elite++;
        else if (t.includes('pro')) tiers.pro++;
        else tiers.starter++;
      });

      const power =
        tiers.starter * 1 +
        tiers.pro * 3 +
        tiers.elite * 6 +
        fans.length * 0.5 +
        sponsors.length * 2;

      return { tiers, power: Math.round(power) };
    }

    function countUnique(arr, getKey) {
      const set = new Set();
      arr.forEach(item => {
        const k = getKey(item);
        if (k) set.add(k.toLowerCase());
      });
      return set.size;
    }

    function renderSnapshot() {
      const uploads   = mmArr('tkfm_artist_uploads');
      const orders    = mmArr('mixtapeOrders');
      const fans      = mmArr('tkfm_fan_profiles');
      const likes     = mmArr('tkfm_radio_likes');
      const history   = mmArr('tkfm_radio_history');
      const sponsors  = mmArr('sponsors');

      document.getElementById('mm-uploads').textContent   = uploads.length;
      document.getElementById('mm-orders').textContent    = orders.length;
      document.getElementById('mm-fans').textContent      = fans.length;
      document.getElementById('mm-likes').textContent     = likes.length;
      document.getElementById('mm-plays').textContent     = history.length;
      document.getElementById('mm-sponsors').textContent  = sponsors.length;

      const { tiers, power } = computePower(orders, fans, sponsors);
      document.getElementById('mm-tier-starter').textContent = tiers.starter;
      document.getElementById('mm-tier-pro').textContent     = tiers.pro;
      document.getElementById('mm-tier-elite').textContent   = tiers.elite;
      document.getElementById('mm-power').textContent        = power;

      document.getElementById('mm-score-label').textContent =
        'Momentum score: ' + power + ' (dev-mode estimate from orders, fans & sponsors).';

      const stats = mmSafeParse('stats', null);
      const statsExtra = document.getElementById('mm-stats-extra');
      if (!stats) {
        statsExtra.textContent = 'No stats object detected yet. You can store rollout info under a "stats" key if needed.';
      } else {
        const parts = [];
        Object.keys(stats).forEach(k => {
          parts.push(k + ': ' + stats[k]);
        });
        statsExtra.textContent = parts.join(' ‚Ä¢ ');
      }

      // Input mix unique counts
      const uniqueArtists = countUnique(uploads, u => u.artistName || u.artist);
      const uniqueClients = countUnique(orders, o => o.clientName || o.client || o.artistName);
      const activeFans    = fans.filter(f => {
        if (!f || typeof f !== 'object') return false;
        return Boolean(f.points || f.fanPoints || f.likes || (f.history && f.history.length));
      }).length;

      document.getElementById('mm-input-artists').textContent     = uniqueArtists;
      document.getElementById('mm-input-clients').textContent     = uniqueClients;
      document.getElementById('mm-input-active-fans').textContent = activeFans;
    }

    function renderUploadsFeed() {
      const uploads = mmArr('tkfm_artist_uploads').slice().reverse();
      const empty = document.getElementById('mm-uploads-empty');
      const list  = document.getElementById('mm-uploads-list');

      if (!uploads.length) {
        empty.classList.remove('hidden');
        list.classList.add('hidden');
        list.innerHTML = '';
        return;
      }

      empty.classList.add('hidden');
      list.classList.remove('hidden');

      list.innerHTML = uploads.slice(0, 10).map(u => {
        const artist = u.artistName || u.artist || 'Unknown Artist';
        const track  = u.trackTitle || u.title || 'Untitled Record';
        const city   = u.city || '';
        const status = u.status || '';
        const created = mmPrettyDate(u.createdAt || u.timestamp);

        return (
          '<div class="flex items-start gap-2">' +
            '<span class="text-[0.7rem] text-slate-500 mt-[3px]">‚Ä¢</span>' +
            '<div class="min-w-0 flex-1">' +
              '<p class="text-[0.8rem] font-semibold truncate">' + mmEscape(track) + '</p>' +
              '<p class="text-[0.75rem] text-slate-300 truncate">' + mmEscape(artist) +
                (city ? ' ‚Ä¢ ' + mmEscape(city) : '') +
              '</p>' +
              '<p class="text-[0.7rem] text-slate-400 truncate">' +
                (status ? 'Status: ' + mmEscape(status) : 'Status: n/a') +
                (created ? ' ‚Ä¢ ' + mmEscape(created) : '') +
              '</p>' +
            '</div>' +
          '</div>'
        );
      }).join('');
    }

    function renderOrdersFeed() {
      const orders = mmArr('mixtapeOrders').slice().reverse();
      const empty = document.getElementById('mm-orders-empty');
      const list  = document.getElementById('mm-orders-list');

      if (!orders.length) {
        empty.classList.remove('hidden');
        list.classList.add('hidden');
        list.innerHTML = '';
        return;
      }

      empty.classList.add('hidden');
      list.classList.remove('hidden');

      list.innerHTML = orders.slice(0, 10).map(o => {
        const client  = o.clientName || o.client || 'Mixtape Client';
        const project = o.projectTitle || 'Mixtape Project';
        const tier    = o.tier || 'Starter';
        const city    = o.city || '';
        const created = mmPrettyDate(o.createdAt || o.timestamp);

        return (
          '<div class="flex items-start gap-2">' +
            '<span class="text-[0.7rem] text-slate-500 mt-[3px]">‚Ä¢</span>' +
            '<div class="min-w-0 flex-1">' +
              '<p class="text-[0.8rem] font-semibold truncate">' + mmEscape(project) + '</p>' +
              '<p class="text-[0.75rem] text-slate-300 truncate">' + mmEscape(client) +
                ' ‚Ä¢ ' + mmEscape(tier) +
                (city ? ' ‚Ä¢ ' + mmEscape(city) : '') +
              '</p>' +
              (created
                ? '<p class="text-[0.7rem] text-slate-400 truncate">' + mmEscape(created) + '</p>'
                : ''
              ) +
            '</div>' +
          '</div>'
        );
      }).join('');
    }

    function renderPlaysFeed() {
      const history = mmArr('tkfm_radio_history').slice(0, 8);
      const empty = document.getElementById('mm-plays-empty');
      const list  = document.getElementById('mm-plays-list');

      if (!history.length) {
        empty.classList.remove('hidden');
        list.classList.add('hidden');
        list.innerHTML = '';
        return;
      }

      empty.classList.add('hidden');
      list.classList.remove('hidden');

      list.innerHTML = history.map(h => {
        const t = h.track || {};
        const title = t.trackTitle || 'Untitled Record';
        const artist = t.artistName || 'Unknown Artist';
        const city = t.city || '';
        const ts = mmPrettyDate(h.playedAt);

        return (
          '<div class="flex items-start gap-2">' +
            '<span class="text-[0.7rem] text-slate-500 mt-[3px]">‚Ä¢</span>' +
            '<div class="min-w-0 flex-1">' +
              '<p class="text-[0.8rem] font-semibold truncate">' + mmEscape(title) + '</p>' +
              '<p class="text-[0.75rem] text-slate-300 truncate">' + mmEscape(artist) +
                (city ? ' ‚Ä¢ ' + mmEscape(city) : '') +
              '</p>' +
              (ts
                ? '<p class="text-[0.7rem] text-slate-400 truncate">' + mmEscape(ts) + '</p>'
                : ''
              ) +
            '</div>' +
          '</div>'
        );
      }).join('');
    }

    function renderLikesFeed() {
      const likes = mmArr('tkfm_radio_likes').slice().reverse().slice(0, 8);
      const empty = document.getElementById('mm-likes-empty');
      const list  = document.getElementById('mm-likes-list');

      if (!likes.length) {
        empty.classList.remove('hidden');
        list.classList.add('hidden');
        list.innerHTML = '';
        return;
      }

      empty.classList.add('hidden');
      list.classList.remove('hidden');

      list.innerHTML = likes.map(l => {
        const title  = l.trackTitle || 'Untitled Record';
        const artist = l.artistName || 'Unknown Artist';
        const city   = l.city || '';
        const mode   = l.mode || '';
        const liked  = mmPrettyDate(l.likedAt);

        return (
          '<div class="flex items-start gap-2">' +
            '<span class="text-[0.7rem] text-rose-400 mt-[3px]">‚ô•</span>' +
            '<div class="min-w-0 flex-1">' +
              '<p class="text-[0.8rem] font-semibold truncate">' + mmEscape(title) + '</p>' +
              '<p class="text-[0.75rem] text-slate-300 truncate">' + mmEscape(artist) +
                (city ? ' ‚Ä¢ ' + mmEscape(city) : '') +
              '</p>' +
              '<p class="text-[0.7rem] text-slate-400 truncate">' +
                (mode ? 'Mode: ' + mmEscape(mode) + ' ‚Ä¢ ' : '') +
                (liked ? mmEscape(liked) : '') +
              '</p>' +
            '</div>' +
          '</div>'
        );
      }).join('');
    }

    document.addEventListener('DOMContentLoaded', function () {
      const btnRefresh = document.getElementById('mm-refresh');

      function rerender() {
        renderSnapshot();
        renderUploadsFeed();
        renderOrdersFeed();
        renderPlaysFeed();
        renderLikesFeed();
      }

      btnRefresh?.addEventListener('click', rerender);

      // initial
      rerender();
    });
  </script>
  <script src="/js/owner-lock.js" data-owner-page="owner"></script>
  <script type="module" src="/js/tkfm-logo-resolver.js"></script>
</body>
</html>
