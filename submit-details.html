<!-- submit-details.html â€” TKFM Submission Form (ENTERPRISE LOCKED, PUBLIC) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Submit Track Details | TKFM</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{background:#000;color:#fff;font-family:Arial,sans-serif;margin:0;padding:40px 16px}
    .box{max-width:860px;margin:auto;background:#111;border:1px solid #222;border-radius:16px;padding:22px}
    h1{margin-top:0}
    .muted{color:#aaa;font-size:13px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .card{background:#0b0b0b;border:1px solid #222;border-radius:14px;padding:14px;margin-top:14px}
    label{display:block;margin:10px 0 6px;color:#ddd;font-size:13px}
    input,select,textarea,button{
      width:100%;padding:12px;border-radius:10px;border:1px solid #333;
      background:#070707;color:#fff;font-size:14px;box-sizing:border-box
    }
    textarea{min-height:120px;resize:vertical}
    button{cursor:pointer;font-weight:700;background:#1b1b1b}
    button:hover{border-color:#555}
    .ok{color:#7cffb2}
    .err{color:#ff7c7c}
    a{color:#ff00e6;text-decoration:none;font-weight:700}
    a:hover{text-decoration:underline}
    @media (max-width:820px){ .row{grid-template-columns:1fr} }
    code{background:#000;border:1px solid #222;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="box">
    <h1>ðŸŽµ Submit Track Details</h1>
    <p class="muted">
      This form records your submission in TKFMâ€™s system for review.
      Make sure your <strong>audio link is direct</strong> (Cloudinary/Supabase/S3/Dropbox direct file URL).
    </p>

    <div class="card">
      <div class="row">
        <div>
          <label for="plan">Submission Type</label>
          <select id="plan">
            <option value="SUBMIT_BASIC">SUBMIT_BASIC â€” Rotation Review</option>
            <option value="SUBMIT_SPOTLIGHT">SUBMIT_SPOTLIGHT â€” Spotlight</option>
            <option value="SUBMIT_BOOST">SUBMIT_BOOST â€” Rotation Boost</option>
          </select>
          <div class="muted">If you just paid, pick the tier you purchased.</div>
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" placeholder="you@email.com" />
          <div class="muted">We contact you here if changes are needed.</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="artist">Artist Name</label>
          <input id="artist" placeholder="Artist / Stage Name" />
        </div>
        <div>
          <label for="title">Track Title</label>
          <input id="title" placeholder="Song name" />
        </div>
      </div>

      <label for="audio">Audio URL (required)</label>
      <input id="audio" placeholder="https://..." />
      <div class="muted">
        Must be a direct playable/downloadable link. Example: <code>https://res.cloudinary.com/.../track.mp3</code>
      </div>

      <label for="cover">Cover Image URL (optional)</label>
      <input id="cover" placeholder="https://..." />

      <label for="notes">Notes (optional)</label>
      <textarea id="notes" placeholder="Clean/explicit? genre? socials? any notes for the DJ teamâ€¦"></textarea>

      <button id="btn">Submit</button>
      <p id="msg" class="muted"></p>

      <p class="muted" style="margin-top:12px">
        After submitting, you can return to <a href="/index.html">TKFM Home</a>.
      </p>
    </div>
  </div>

  <script>
    const API = '/.netlify/functions'

    // Optional: prefill plan from URL like ?plan=SUBMIT_BOOST
    const qs = new URLSearchParams(location.search)
    const planParam = (qs.get('plan') || '').trim().toUpperCase()
    if (planParam) {
      const planEl = document.getElementById('plan')
      for (const opt of planEl.options) {
        if (opt.value === planParam) planEl.value = planParam
      }
    }

    function setMsg(text, cls) {
      const el = document.getElementById('msg')
      el.textContent = text || ''
      el.className = cls || 'muted'
    }

    function isEmail(v) {
      v = String(v || '').trim()
      return v.includes('@') && v.includes('.')
    }

    document.getElementById('btn').addEventListener('click', async () => {
      const plan = document.getElementById('plan').value
      const email = document.getElementById('email').value.trim()
      const artist_name = document.getElementById('artist').value.trim()
      const track_title = document.getElementById('title').value.trim()
      const audio_url = document.getElementById('audio').value.trim()
      const cover_url = document.getElementById('cover').value.trim()
      const notes = document.getElementById('notes').value.trim()

      if (!artist_name || !track_title || !audio_url || !email) {
        return setMsg('Artist, Track Title, Email, and Audio URL are required.', 'err')
      }
      if (!isEmail(email)) {
        return setMsg('Please enter a valid email address.', 'err')
      }
      if (!audio_url.startsWith('http')) {
        return setMsg('Audio URL must start with http/https.', 'err')
      }
      if (cover_url && !cover_url.startsWith('http')) {
        return setMsg('Cover URL must start with http/https.', 'err')
      }

      setMsg('Submittingâ€¦', 'muted')

      try {
        const res = await fetch(`${API}/public-create-submission`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            plan,
            email,
            artist_name,
            track_title,
            audio_url,
            cover_url: cover_url || null,
            notes: notes || null
          })
        })

        const data = await res.json().catch(() => ({}))

        if (!res.ok || !data.ok) {
          return setMsg(data.error || 'Submission failed. Try again.', 'err')
        }

        setMsg('âœ… Submission received! Weâ€™ll review it soon.', 'ok')
        setTimeout(() => location.href = '/index.html', 1200)
      } catch (e) {
        setMsg('Network error. Please try again.', 'err')
      }
    })
  </script>
</body>
</html>
